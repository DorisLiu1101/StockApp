<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Gemini API æ¸¬è©¦æ²™ç›’</title>
</head>
<body style="background-color: #1A1C1E; color: white; font-family: sans-serif; padding: 20px;">
    
    <h2>ğŸ§  Gemini å¤§è…¦é€£ç·šæ¸¬è©¦</h2>
    <button onclick="testGeminiAPI()" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">
        ğŸš€ é»æ“Šæ¸¬è©¦å‘¼å« Gemini
    </button>
    <p>è«‹æŒ‰ä¸‹æŒ‰éˆ•å¾Œï¼Œæ‰“é–‹ç€è¦½å™¨çš„ã€Œé–‹ç™¼è€…å·¥å…· (æŒ‰ F12)ã€ï¼ŒæŸ¥çœ‹ Console æ¨™ç±¤é çš„çµæœã€‚</p>

    <script>

// ğŸ”‘ æ­¥é©Ÿ 1ï¼šè²¼ä¸Šä½ çš„ API Key
const API_KEY = 'AIzaSyDIRFSGw4qt0jYcplgBWFywc_nwXNwdK6I'; 

async function testGeminiAPI() {
    console.log("â³ æ­£åœ¨å•Ÿå‹• Gemini 2.5 Flash è¯ç¶²å¤§è…¦...");

    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;

    const requestBody = {
        "contents": [{
            // ğŸ“ å¼·åŒ– Promptï¼šåš´æ ¼å‘½ä»¤å®ƒåªèƒ½è¼¸å‡º JSONï¼Œä¸è¦ Markdown
            "parts": [{"text": "è«‹å»æœå°‹ä»Šå¤©å°ç©é›»(2330)çš„æœ€æ–°è²¡ç¶“æ–°èèˆ‡è‚¡åƒ¹æ¦‚æ³ã€‚è«‹åš´æ ¼è¼¸å‡ºç´” JSON æ ¼å¼ï¼Œå¿…é ˆåŒ…å«ï¼š'date' (ä»Šå¤©çš„æ—¥æœŸ), 'price_status' (ä½ æŸ¥åˆ°çš„è‚¡åƒ¹ç‹€æ³æè¿°), 'latest_news' (ä½ æŸ¥åˆ°çš„ä¸€æ¢çœŸå¯¦æ–°èæ¨™é¡Œ)ã€‚è«‹ç›´æ¥è¼¸å‡ºå¤§æ‹¬è™Ÿ {} åŒ…è£¹çš„å…§å®¹ï¼Œçµ•å°ä¸è¦ä½¿ç”¨ ```json æ¨™è¨˜æˆ–ä»»ä½•å»¢è©±ã€‚"}]
        }],
        // ğŸ›¡ï¸ ä¿ç•™ï¼šå¼·åˆ¶è¯ç¶²æœå°‹ (ç¢ºä¿è³‡è¨Šæ˜¯ä»Šå¤©æœ€æ–°çš„)
        "tools": [
            {
                "googleSearch": {}
            }
        ],
        "generationConfig": {
            // ğŸ“ ç§»é™¤ï¼šæŠŠ "responseMimeType": "application/json" æ‹¿æ‰ï¼Œé¿å…è¡çª
            "temperature": 0.0 // å‰µæ„åº¦æ­¸é›¶ï¼Œç¢ºä¿åš´è¬¹
        }
    };

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(requestBody)
        });

        const data = await response.json();

        if (!response.ok) {
            console.error("âŒ ä¼ºæœå™¨éŒ¯èª¤ï¼š", data.error.message);
            return;
        }
        
        // å–å¾— AI å›å‚³çš„åŸå§‹æ–‡å­—
        let aiResultString = data.candidates[0].content.parts[0].text;
        
        // ğŸ§¹ æ¸…æ´—éæ¿¾å™¨ï¼šæŠŠ AI å¯èƒ½ä¸å°å¿ƒåŠ ä¸Šçš„ Markdown æ¨™è¨˜ (```json å’Œ ```) ç§»é™¤
        aiResultString = aiResultString.replace(/```json/gi, '').replace(/```/g, '').trim();
        
        // å°‡ä¹¾æ·¨çš„å­—ä¸²è½‰æ›ç‚º JavaScript ç‰©ä»¶
        const aiResultObject = JSON.parse(aiResultString); 

        console.log("âœ… å¼•æ“é»ç«æˆåŠŸï¼è¯ç¶²æŸ¥è­‰å®Œç•¢ã€‚é€™æ˜¯ AI å‰›å‰›ä¸Šç¶²æŸ¥åˆ°çš„çœŸå¯¦æ•¸æ“šï¼š");
        console.log("ğŸ“… æŸ¥è­‰æ—¥æœŸï¼š" + aiResultObject.date);
        console.log("ğŸ’° è‚¡åƒ¹ç¾æ³ï¼š" + aiResultObject.price_status);
        console.log("ğŸ“° æœ€æ–°æ–°èï¼š" + aiResultObject.latest_news);

    } catch (error) {
        console.error("âŒ ç™¼ç”ŸéŒ¯èª¤ (å¯èƒ½æ˜¯ JSON è§£æå¤±æ•—)ï¼š", error);
    }
}

testGeminiAPI();

// ==========================================
// ğŸ“Š ç¡¬æ•¸æ“šæ¨¡çµ„ï¼šæŠ“å– Yahoo Finance è‚¡åƒ¹
// ==========================================
async function fetchStockPrice(stockCode) {
    console.log(`\nâ³ æ­£åœ¨å‘¼å«ä»£ç†å¤–é€å“¡ (Proxy) ç²å– ${stockCode} çš„çµ•å°çœŸå¯¦è‚¡åƒ¹...`);

    // ğŸ“ æ­¥é©Ÿ 1ï¼šYahoo Finance çš„åŸå§‹ç¶²å€ (å°è‚¡ä»£è™Ÿå¾Œé¢å¿…é ˆåŠ  .TW)
    const targetUrl = `https://query1.finance.yahoo.com/v8/finance/chart/${stockCode}.TW`;

    // ğŸ“ æ­¥é©Ÿ 2ï¼šä½¿ç”¨å…è²»çš„ CORS ä»£ç†ä¼ºæœå™¨ (corsproxy.io) ç¹éè­¦è¡›
    // æˆ‘å€‘æŠŠ Yahoo çš„ç¶²å€ã€ŒåŒ…è£ã€åœ¨ä»£ç†ä¼ºæœå™¨çš„ç¶²å€å¾Œé¢
    const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(targetUrl)}`;

    try {
        // ç™¼é€ç¶²è·¯è«‹æ±‚ (Fetch API)
        const response = await fetch(proxyUrl);
        const data = await response.json();

        // ğŸ“ æ­¥é©Ÿ 3ï¼šåƒæ‹†ä¿„ç¾…æ–¯å¨ƒå¨ƒä¸€æ¨£ï¼Œå¾ Yahoo è¤‡é›œçš„ JSON åŒ…è£¹ä¸­å–å‡ºæˆ‘å€‘è¦çš„æ•¸å­—
        const result = data.chart.result[0];
        const currentPrice = result.meta.regularMarketPrice;     // ç›®å‰å³æ™‚è‚¡åƒ¹
        const previousClose = result.meta.chartPreviousClose;    // æ˜¨æ”¶åƒ¹

        // ğŸ“ æ­¥é©Ÿ 4ï¼šæ•¸å­¸è¨ˆç®— (è¨ˆç®—æ¼²è·Œå¹…)
        const change = (currentPrice - previousClose).toFixed(2); // æ¼²è·Œé‡‘é¡ (å–å°æ•¸é»å¾Œå…©ä½)
        const changePercent = ((change / previousClose) * 100).toFixed(2); // æ¼²è·Œç™¾åˆ†æ¯”

        console.log(`âœ… æˆåŠŸå–å¾—ç¡¬æ•¸æ“šï¼`);
        console.log(`ğŸ’° ${stockCode} ç›®å‰è‚¡åƒ¹: $${currentPrice}`);
        console.log(`ğŸ“ˆ ä»Šæ—¥æ¼²è·Œ: ${change} (${changePercent}%)`);

        // å°‡æ•¸æ“šæ‰“åŒ…å›å‚³ï¼Œæº–å‚™æœªä¾†çµ¦ AI å’Œ HTML ä½¿ç”¨
        return { 
            price: currentPrice, 
            change: change, 
            percent: changePercent 
        };

    } catch (error) {
        console.error("âŒ æŠ“å–è‚¡åƒ¹å¤±æ•— (å¯èƒ½æ˜¯è‚¡ç¥¨ä»£è™ŸéŒ¯èª¤æˆ–ä»£ç†ä¼ºæœå™¨å¿™ç¢Œ)ï¼š", error);
    }
}

// åŸ·è¡Œæ¸¬è©¦æŒ‡ä»¤ (ä½ å¯ä»¥æŠŠ 2330 æ›æˆå…¶ä»–å°è‚¡ä»£è™Ÿè©¦è©¦çœ‹ï¼)
fetchStockPrice('2330');


    </script>
</body>
</html>